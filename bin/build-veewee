#!/bin/bash -e

nm_base=$1; shift
source "config/$nm_base"
bin/bundler

figlet "build veewee"
bundle exec vagrant box remove "$veewee_name" 2>&1 || VBoxManage unregistervm $veewee_name --delete || true
bundle exec vagrant basebox build "$veewee_name" -f -n

cd definitions/$veewee_name

figlet "exporting veewee"
rm -f "$veewee_name.box"
bundle exec vagrant basebox export "$veewee_name"

figlet "build vagrant"
bundle exec vagrant box remove "$vagrant_name" 2>&1 || VBoxManage unregistervm $vagrant_name --delete || true
bundle exec vagrant box add "$vagrant_name" "$veewee_name.box"
