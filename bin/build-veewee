#!/bin/bash -e

nm_base=$1; shift
source "config/$nm_base"
bin/bundler

figlet "build veewee"
bundle exec vagrant box remove "$nm_base" 2>&1 || VBoxManage unregistervm $nm_base --delete || true
bundle exec vagrant basebox build "$nm_base" -f -n

cd definitions/$nm_base

figlet "exporting veewee"
rm -f "$nm_base.box"
bundle exec vagrant basebox export "$nm_base"

figlet "build vagrant"
bundle exec vagrant box remove "$nm_base" 2>&1 || VBoxManage unregistervm $nm_base --delete || true
bundle exec vagrant box add "$nm_base" "$nm_base.box"
