#!/bin/bash

tmp_aliases=$(mktemp -t XXXXXX)

for pth_config in config/*; do
	[[ -f $pth_config ]] || continue
	source $pth_config

	pth_vagrant=$(pwd)/vagrant/$vagrantname
	[[ -d $pth_vagrant ]] || continue

  nm_vagrant="${pth_config##*/}"
  cat >> $tmp_aliases << EOF
  function $nm_vagrant {
    pushd $(pwd) > /dev/null
    case "\$1" in
      ssh_config)
        bin/vagrant $nm_vagrant ssh_config | sed "s#Host default#Host $nm_vagrant#"
        echo "  ForwardAgent yes"
        ;;
      up)
        bin/vagrant $nm_vagrant up \$(ifconfig "vboxnet0" 2>&- | grep 'inet ' | awk '{print \$2}' | cut -d. -f1-3).\$${nm_vagrant}_ip
        ;;
      *)
        bin/vagrant $nm_vagrant ssh "\$@"
        ;;
    esac
    popd > /dev/null
  }
EOF
done
unset pth_vagrant

source $tmp_aliases
rm -f $tmp_aliases

