#!/bin/bash -e

nm_base=$1; shift
source "config/$nm_base"
bin/bundler

nm_build=$(basename $(cat definitions/${veewee_name}/definition.rb  | grep iso_file | cut -d'"' -f2) .iso) # TODO weak
url_build=$(cat definitions/${veewee_name}/definition.rb  | grep iso_src | cut -d'"' -f2) # TODO weak

cd vagrant/$vagrant_name

figlet "start vagrant"
bundle exec vagrant destroy || true
bundle exec vagrant up

cd - > /dev/null
figlet "postinstall"
bin/vagrant $nm_base rsync vagrant/$vagrant_name/postinstall.sh postinstall.sh
bin/vagrant $nm_base ssh ./postinstall.sh vagrant
