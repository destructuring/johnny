#!/bin/bash -e

for a in "$@"; do
  source "config/${a}"
  export veewee_name vagrant_name

	nm_build=$(basename $(cat definitions/${veewee_name}/definition.rb  | grep iso_file | cut -d'"' -f2) .iso) # TODO weak
  url_build=$(cat definitions/${veewee_name}/definition.rb  | grep iso_src | cut -d'"' -f2) # TODO weak

  export VAGRANT_VM_NETWORK="${PANCAKE_NETWORK}.$(eval echo '"''$'"${a}_ip"'"')"

  figlet "start vagrant"
  bin/vagrant $a destroy || true
  bin/vagrant $a up

  figlet "postinstall"
  bin/vagrant $a ssh bash postinstall.sh vagrant

  figlet "custom"
  ../config/vagrant-custom $a $VAGRANT_VM_NETWORK
done

