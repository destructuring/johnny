#!/bin/bash -e

[[ -d .git ]] || {
	echo "ERROR: must be at root of git workarea" 1>&2
	exit 1
}

bundle config build.nokogiri --with-xslt-dir=/opt/zendesk/macports/local
bundle check || bundle --local --path vendor/bundle

for a in "$@"; do
  bin/build-ubuntu $a
  bin/build-vagrant $a -f
  eval bin/vagrant ${a}_vagrant up '"''$'"${a}_ip"'"'
  bin/vagrant ${a}_vagrant ssh bash postinstall.sh vagrant
done

