#!/bin/bash -e

nm_base=$1; shift
bin/bundler

figlet "build box"
bundle exec vagrant basebox build "$nm_base" -f -n

figlet "exporting box"
pushd definitions/$nm_base > /dev/null
rm -f "$nm_base.box"
bundle exec vagrant basebox export "$nm_base"
popd > /dev/null

figlet "importing box"
bundle exec vagrant box remove "$nm_base" 2>&1 || VBoxManage unregistervm $nm_base --delete || true
bundle exec vagrant box add "$nm_base" "definitions/$nm_base/$nm_base.box"
